{% extends 'base.html.twig' %}

{% block title %}{{ jenis_cuti.nama }} - Detail Jenis Cuti{% endblock %}

{% block body %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Detail Jenis Cuti</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <div class="btn-group me-2">
            <a href="{{ path('admin_jenis_cuti_edit', {'id': jenis_cuti.id}) }}" class="btn btn-primary">
                <i class="bi bi-pencil"></i> Edit
            </a>
            <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">
                <i class="bi bi-trash"></i> Hapus
            </button>
        </div>
        <a href="{{ path('admin_jenis_cuti_index') }}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Kembali
        </a>
    </div>
</div>

<!-- Jenis Cuti Details -->
<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-info-circle"></i> Informasi Jenis Cuti
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-muted">Kode</h6>
                        <p class="h4 text-primary mb-3">{{ jenis_cuti.kode }}</p>
                        
                        <h6 class="text-muted">Nama Jenis Cuti</h6>
                        <p class="h5 mb-3">{{ jenis_cuti.nama }}</p>
                        
                        <h6 class="text-muted">Tersedia Untuk</h6>
                        <p class="mb-3">
                            <span class="badge {{ jenis_cuti.tersediUntuk == 'PNS' ? 'bg-success' : (jenis_cuti.tersediUntuk == 'PPPK' ? 'bg-primary' : 'bg-info') }} fs-6">
                                {{ jenis_cuti.tersediUntuk }}
                            </span>
                        </p>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-muted">Durasi Maksimal</h6>
                        <p class="mb-3">
                            {% if jenis_cuti.durasiMax %}
                                <span class="badge bg-info fs-6">{{ jenis_cuti.durasiMax }} hari</span>
                            {% else %}
                                <span class="badge bg-secondary fs-6">Tidak terbatas</span>
                            {% endif %}
                        </p>
                        
                        <h6 class="text-muted">Dasar Hukum</h6>
                        <p class="mb-3">
                            {% if jenis_cuti.dasarHukum %}
                                {{ jenis_cuti.dasarHukum }}
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </p>
                        
                        <h6 class="text-muted">Tanggal Dibuat</h6>
                        <p class="mb-3">{{ jenis_cuti.createdAt|date('d/m/Y H:i') }}</p>
                        
                        <h6 class="text-muted">Terakhir Diperbarui</h6>
                        <p class="mb-3">{{ jenis_cuti.updatedAt|date('d/m/Y H:i') }}</p>
                    </div>
                </div>
                
                {% if jenis_cuti.deskripsi %}
                <hr>
                <h6 class="text-muted">Deskripsi</h6>
                <div class="p-3 bg-light rounded">
                    {{ jenis_cuti.deskripsi|nl2br }}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <!-- Statistics Card -->
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="bi bi-graph-up"></i> Statistik Penggunaan
                </h6>
            </div>
            <div class="card-body">
                <div class="text-center">
                    <h2 class="text-primary">{{ jenis_cuti.pengajuanCutis|length }}</h2>
                    <p class="text-muted">Total Pengajuan</p>
                </div>
                
                {% set approved_count = jenis_cuti.pengajuanCutis|filter(p => p.status == 'disetujui')|length %}
                {% set pending_count = jenis_cuti.pengajuanCutis|filter(p => p.status == 'diajukan')|length %}
                {% set rejected_count = jenis_cuti.pengajuanCutis|filter(p => p.status == 'ditolak')|length %}
                
                <div class="row text-center">
                    <div class="col-4">
                        <div class="p-2 bg-success bg-opacity-10 rounded">
                            <h5 class="text-success mb-1">{{ approved_count }}</h5>
                            <small class="text-muted">Disetujui</small>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="p-2 bg-warning bg-opacity-10 rounded">
                            <h5 class="text-warning mb-1">{{ pending_count }}</h5>
                            <small class="text-muted">Pending</small>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="p-2 bg-danger bg-opacity-10 rounded">
                            <h5 class="text-danger mb-1">{{ rejected_count }}</h5>
                            <small class="text-muted">Ditolak</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Usage Rules Card -->
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="bi bi-shield-check"></i> Ketentuan Penggunaan
                </h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled mb-0">
                    <li class="mb-2">
                        <i class="bi bi-check-circle text-success me-2"></i>
                        <small>
                            Tersedia untuk: 
                            <strong>{{ jenis_cuti.tersediUntuk }}</strong>
                        </small>
                    </li>
                    <li class="mb-2">
                        <i class="bi bi-clock text-info me-2"></i>
                        <small>
                            Durasi maksimal: 
                            <strong>
                                {% if jenis_cuti.durasiMax %}
                                    {{ jenis_cuti.durasiMax }} hari
                                {% else %}
                                    Tidak terbatas
                                {% endif %}
                            </strong>
                        </small>
                    </li>
                    {% if jenis_cuti.dasarHukum %}
                    <li class="mb-2">
                        <i class="bi bi-book text-primary me-2"></i>
                        <small>Memiliki dasar hukum yang valid</small>
                    </li>
                    {% endif %}
                    <li class="mb-0">
                        <i class="bi bi-calendar-event text-secondary me-2"></i>
                        <small>
                            Digunakan dalam <strong>{{ jenis_cuti.pengajuanCutis|length }}</strong> pengajuan
                        </small>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Recent Usage -->
{% if jenis_cuti.pengajuanCutis|length > 0 %}
<div class="card mt-4">
    <div class="card-header">
        <h6 class="mb-0">
            <i class="bi bi-clock-history"></i> Pengajuan Terbaru
        </h6>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-sm mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Tanggal</th>
                        <th>Nama Pemohon</th>
                        <th>Periode Cuti</th>
                        <th>Status</th>
                        <th width="80">Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    {% for pengajuan in jenis_cuti.pengajuanCutis|slice(0, 10) %}
                    <tr>
                        <td>{{ pengajuan.tanggalPengajuan|date('d/m/Y') }}</td>
                        <td>
                            <div>
                                <strong>{{ pengajuan.user.nama }}</strong>
                                <br><small class="text-muted">{{ pengajuan.user.nip }}</small>
                            </div>
                        </td>
                        <td>
                            <small>
                                {{ pengajuan.tanggalMulai|date('d/m/Y') }} - 
                                {{ pengajuan.tanggalSelesai|date('d/m/Y') }}
                                <br><span class="text-muted">({{ pengajuan.lamaCuti }} hari)</span>
                            </small>
                        </td>
                        <td>
                            <span class="badge 
                                {% if pengajuan.status == 'disetujui' %}bg-success
                                {% elseif pengajuan.status == 'diajukan' %}bg-warning
                                {% elseif pengajuan.status == 'ditolak' %}bg-danger
                                {% else %}bg-secondary{% endif %}">
                                {{ pengajuan.status|title }}
                            </span>
                        </td>
                        <td>
                            <a href="{{ path('pengajuan_cuti_show', {'id': pengajuan.id}) }}" 
                               class="btn btn-sm btn-outline-info" title="Lihat Detail">
                                <i class="bi bi-eye"></i>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% if jenis_cuti.pengajuanCutis|length > 10 %}
        <div class="card-footer text-center">
            <small class="text-muted">
                Dan {{ jenis_cuti.pengajuanCutis|length - 10 }} pengajuan lainnya...
            </small>
        </div>
        {% endif %}
    </div>
</div>
{% endif %}

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Konfirmasi Hapus</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Yakin ingin menghapus jenis cuti <strong>{{ jenis_cuti.nama }}</strong> ({{ jenis_cuti.kode }})?</p>
                {% if jenis_cuti.pengajuanCutis|length > 0 %}
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle"></i>
                    <strong>Peringatan:</strong> Jenis cuti ini memiliki {{ jenis_cuti.pengajuanCutis|length }} pengajuan terkait. Penghapusan mungkin tidak diizinkan.
                </div>
                {% else %}
                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i>
                    Jenis cuti ini tidak memiliki pengajuan terkait dan aman untuk dihapus.
                </div>
                {% endif %}
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                <form action="{{ path('admin_jenis_cuti_delete', {'id': jenis_cuti.id}) }}" method="post" class="d-inline">
                    <input type="hidden" name="_token" value="{{ csrf_token('delete_' ~ jenis_cuti.id) }}">
                    <button type="submit" class="btn btn-danger">
                        <i class="bi bi-trash"></i> Ya, Hapus
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block javascripts %}
<script>
// Auto-refresh statistics every 30 seconds
setInterval(function() {
    // You can implement AJAX refresh for statistics here if needed
}, 30000);
</script>
{% endblock %}