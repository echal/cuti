{# Form untuk pengajuan cuti dengan info hak cuti #}

{# Info Hak Cuti Tahun Berjalan #}
<div class="row mb-4">
    <div class="col-12">
        <div class="card border-info">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                    <i class="bi bi-info-circle"></i> 
                    Informasi Hak Cuti {{ 'now'|date('Y') }}
                </h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md-2">
                        <div class="border rounded p-2 bg-light">
                            <h6 class="text-muted">Hak {{ 'now'|date('Y') }}</h6>
                            <h4 class="text-primary">{{ hak_cuti ? hak_cuti.hakTahunan : 12 }}</h4>
                            <small>hari</small>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="border rounded p-2 bg-light">
                            <h6 class="text-muted">Cuti Tahun Lalu (N-1)</h6>
                            <h4 class="text-info">{{ hak_cuti_n1 ? hak_cuti_n1.sisa : 0 }}</h4>
                            <small>hari</small>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="border rounded p-2 bg-light">
                            <h6 class="text-muted">Cuti Dua Tahun Lalu (N-2)</h6>
                            <h4 class="text-info">{{ hak_cuti_n2 ? hak_cuti_n2.sisa : 0 }}</h4>
                            <small>hari</small>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="border rounded p-2 bg-success text-white">
                            <h6>Total Hak</h6>
                            {% set total_hak = (hak_cuti ? hak_cuti.hakTahunan : 12) + (hak_cuti_n1 ? hak_cuti_n1.sisa : 0) + (hak_cuti_n2 ? hak_cuti_n2.sisa : 0) %}
                            <h4>{{ total_hak }}</h4>
                            <small>hari</small>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="border rounded p-2 bg-warning">
                            <h6>Terpakai</h6>
                            <h4>{{ hak_cuti ? hak_cuti.terpakai : 0 }}</h4>
                            <small>hari</small>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="border rounded p-2 bg-primary text-white">
                            <h6><strong>Sisa</strong></h6>
                            <h4><strong>{{ hak_cuti ? hak_cuti.sisa : 12 }}</strong></h4>
                            <small>hari</small>
                        </div>
                    </div>
                </div>
                
                <div class="mt-3">
                    <small class="text-muted">
                        <i class="bi bi-lightbulb"></i>
                        <strong>Catatan:</strong> 
                        Cuti yang dapat dibawa dari tahun sebelumnya dibatasi maksimal 6 hari per tahun. 
                        Total akumulasi maksimal 24 hari. 
                        Penggunaan menggunakan sistem FIFO (First In, First Out).
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

{# Form Pengajuan #}
<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Form Pengajuan Cuti</h5>
            </div>
            <div class="card-body">
                {{ form_start(form) }}
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            {{ form_label(form.jenisCuti, 'Jenis Cuti', {'label_attr': {'class': 'form-label'}}) }}
                            {{ form_widget(form.jenisCuti, {'attr': {'class': 'form-select'}}) }}
                            {{ form_errors(form.jenisCuti) }}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Durasi Estimasi (Hari Kerja)</label>
                            <input type="text" class="form-control" id="durasi-estimasi" readonly 
                                   placeholder="Akan dihitung otomatis">
                            <small class="text-muted">Dihitung berdasarkan hari kerja (Senin s/d Jumat)</small>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            {{ form_label(form.tanggalMulai, 'Tanggal Mulai', {'label_attr': {'class': 'form-label'}}) }}
                            {{ form_widget(form.tanggalMulai, {'attr': {'class': 'form-control', 'id': 'tanggal-mulai'}}) }}
                            {{ form_errors(form.tanggalMulai) }}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            {{ form_label(form.tanggalSelesai, 'Tanggal Selesai', {'label_attr': {'class': 'form-label'}}) }}
                            {{ form_widget(form.tanggalSelesai, {'attr': {'class': 'form-control', 'id': 'tanggal-selesai'}}) }}
                            {{ form_errors(form.tanggalSelesai) }}
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    {{ form_label(form.alasan, 'Alasan Cuti', {'label_attr': {'class': 'form-label'}}) }}
                    {{ form_widget(form.alasan, {'attr': {'class': 'form-control', 'rows': 3, 'placeholder': 'Jelaskan alasan pengajuan cuti Anda...'}}) }}
                    {{ form_errors(form.alasan) }}
                </div>

                <div class="mb-3">
                    {{ form_label(form.alamatCuti, 'Alamat Selama Menjalankan Cuti', {'label_attr': {'class': 'form-label'}}) }}
                    {{ form_widget(form.alamatCuti, {'attr': {'class': 'form-control', 'rows': 3, 'placeholder': 'Masukkan alamat lengkap selama menjalankan cuti...'}}) }}
                    {% if form.alamatCuti.vars.help %}
                        <div class="form-text">{{ form.alamatCuti.vars.help }}</div>
                    {% endif %}
                    {{ form_errors(form.alamatCuti) }}
                </div>

                <div class="mb-3">
                    {{ form_label(form.userTelp, 'Nomor Telepon', {'label_attr': {'class': 'form-label'}}) }}
                    {{ form_widget(form.userTelp, {'attr': {'class': 'form-control', 'placeholder': 'Contoh: 08123456789 atau +628123456789'}}) }}
                    {% if form.userTelp.vars.help %}
                        <div class="form-text">{{ form.userTelp.vars.help }}</div>
                    {% endif %}
                    {{ form_errors(form.userTelp) }}
                </div>

                {# File pendukung dinonaktifkan sementara
                <div class="mb-3">
                    {{ form_label(form.filePendukung, 'File Pendukung', {'label_attr': {'class': 'form-label'}}) }}
                    {{ form_widget(form.filePendukung, {'attr': {'class': 'form-control'}}) }}
                    {% if form.filePendukung.vars.help %}
                        <div class="form-text">{{ form.filePendukung.vars.help }}</div>
                    {% endif %}
                    {{ form_errors(form.filePendukung) }}
                </div>
                #}

                {# Hidden fields #}
                {{ form_row(form._token) }}

                <div class="d-flex justify-content-between">
                    <a href="{{ path('pengajuan_cuti_index') }}" class="btn btn-secondary">
                        <i class="bi bi-arrow-left"></i> Kembali
                    </a>
                    
                    <div>
                        {% if pengajuan is defined and pengajuan.status == 'ditolak' %}
                            {# Tombol khusus untuk pengajuan ditolak #}
                            <button type="submit" name="status" value="draft" class="btn btn-outline-warning me-2" id="btn-draft">
                                <i class="bi bi-save"></i> Simpan Perbaikan
                            </button>
                            <button type="button" class="btn btn-success" id="btn-ajukan" onclick="confirmResubmit()">
                                <i class="bi bi-arrow-repeat"></i> Ajukan Ulang
                            </button>
                            <button type="submit" name="status" value="submit" class="btn btn-success d-none" id="btn-submit-hidden">
                                <i class="bi bi-arrow-repeat"></i> Ajukan Ulang
                            </button>
                        {% else %}
                            {# Tombol default untuk pengajuan baru atau draft #}
                            <button type="submit" name="status" value="draft" class="btn btn-outline-primary me-2" id="btn-draft">
                                <i class="bi bi-save"></i> Simpan Draft
                            </button>
                            <button type="button" class="btn btn-primary" id="btn-ajukan" onclick="confirmSubmit()">
                                <i class="bi bi-send"></i> Ajukan Cuti
                            </button>
                            <button type="submit" name="status" value="submit" class="btn btn-primary d-none" id="btn-submit-hidden">
                                <i class="bi bi-send"></i> Ajukan Cuti
                            </button>
                        {% endif %}
                    </div>
                </div>

                {{ form_end(form, {'render_rest': false}) }}
            </div>
        </div>
    </div>

    <div class="col-md-4">
        {# Tips dan Informasi #}
        <div class="card">
            <div class="card-header bg-light">
                <h6 class="mb-0">
                    <i class="bi bi-lightbulb"></i> Tips Pengajuan
                </h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled mb-0">
                    <li class="mb-2">
                        <i class="bi bi-check-circle text-success"></i>
                        <small>Pastikan tanggal tidak bertabrakan dengan cuti sebelumnya</small>
                    </li>
                    <li class="mb-2">
                        <i class="bi bi-check-circle text-success"></i>
                        <small>Cuti tahunan memerlukan saldo yang mencukupi</small>
                    </li>
                    <li class="mb-2">
                        <i class="bi bi-check-circle text-success"></i>
                        <small>Cuti sakit >3 hari perlu surat dokter</small>
                    </li>
                    <li class="mb-2">
                        <i class="bi bi-check-circle text-success"></i>
                        <small>Alamat selama cuti wajib diisi untuk keperluan surat resmi</small>
                    </li>
                    <li class="mb-2">
                        <i class="bi bi-check-circle text-success"></i>
                        <small>Upload file pendukung jika diperlukan (opsional)</small>
                    </li>
                </ul>
            </div>
        </div>

        {# Aturan Cuti #}
        <div class="card mt-3">
            <div class="card-header bg-light">
                <h6 class="mb-0">
                    <i class="bi bi-book"></i> Aturan Cuti
                </h6>
            </div>
            <div class="card-body">
                <div class="accordion accordion-flush" id="aturanAccordion">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                    data-bs-target="#cuti-tahunan">
                                Cuti Tahunan
                            </button>
                        </h2>
                        <div id="cuti-tahunan" class="accordion-collapse collapse" data-bs-parent="#aturanAccordion">
                            <div class="accordion-body">
                                <small>
                                    • Hak: 12 hari/tahun<br>
                                    • Masa kerja minimal: 1 tahun<br>
                                    • Dapat dibawa ke tahun berikutnya maks 6 hari<br>
                                    • Total maksimal: 24 hari
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                    data-bs-target="#cuti-besar">
                                Cuti Besar
                            </button>
                        </h2>
                        <div id="cuti-besar" class="accordion-collapse collapse" data-bs-parent="#aturanAccordion">
                            <div class="accordion-body">
                                <small>
                                    • Durasi: 90 hari<br>
                                    • Hanya PNS<br>
                                    • Masa kerja minimal: 6 tahun<br>
                                    • Setiap 6 tahun sekali
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{# Modal Konfirmasi #}
<div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="confirmModalLabel">
                    <i class="bi bi-check-circle"></i> Konfirmasi Pengajuan Cuti
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="mb-3"><strong>Pastikan data yang Anda masukkan sudah benar:</strong></p>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="card border-0 bg-light mb-3">
                            <div class="card-body py-2">
                                <h6 class="text-muted mb-1">Jenis Cuti</h6>
                                <span id="confirm-jenis-cuti" class="fw-bold">-</span>
                            </div>
                        </div>
                        <div class="card border-0 bg-light mb-3">
                            <div class="card-body py-2">
                                <h6 class="text-muted mb-1">Tanggal Mulai</h6>
                                <span id="confirm-tanggal-mulai" class="fw-bold">-</span>
                            </div>
                        </div>
                        <div class="card border-0 bg-light mb-3">
                            <div class="card-body py-2">
                                <h6 class="text-muted mb-1">Tanggal Selesai</h6>
                                <span id="confirm-tanggal-selesai" class="fw-bold">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card border-0 bg-light mb-3">
                            <div class="card-body py-2">
                                <h6 class="text-muted mb-1">Durasi</h6>
                                <span id="confirm-durasi" class="fw-bold">-</span>
                            </div>
                        </div>
                        <div class="card border-0 bg-light mb-3">
                            <div class="card-body py-2">
                                <h6 class="text-muted mb-1">Alamat Selama Cuti</h6>
                                <span id="confirm-alamat" class="fw-bold">-</span>
                            </div>
                        </div>
                        <div class="card border-0 bg-light mb-3">
                            <div class="card-body py-2">
                                <h6 class="text-muted mb-1">Nomor Telepon</h6>
                                <span id="confirm-telepon" class="fw-bold">-</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card border-0 bg-light">
                    <div class="card-body py-2">
                        <h6 class="text-muted mb-1">Alasan Cuti</h6>
                        <span id="confirm-alasan" class="fw-bold">-</span>
                    </div>
                </div>
                
                <div class="alert alert-info mt-3 mb-0">
                    <i class="bi bi-info-circle"></i>
                    <strong>Perhatian:</strong> Setelah Anda mengajukan cuti, data akan dikirim kepada atasan untuk persetujuan dan tidak dapat diubah lagi.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-arrow-left"></i> Periksa Kembali
                </button>
                <button type="button" class="btn btn-primary" onclick="submitForm()">
                    <i class="bi bi-check-lg"></i> Ya, Data Sudah Benar
                </button>
            </div>
        </div>
    </div>
</div>

{# JavaScript untuk kalkulasi durasi #}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const tanggalMulai = form ? form.querySelector('input[name*="tanggalMulai"]') : null;
    const tanggalSelesai = form ? form.querySelector('input[name*="tanggalSelesai"]') : null;
    const durasiEstimasi = document.getElementById('durasi-estimasi');

    function hitungDurasi() {
        if (tanggalMulai && tanggalSelesai && tanggalMulai.value && tanggalSelesai.value) {
            const mulai = new Date(tanggalMulai.value);
            const selesai = new Date(tanggalSelesai.value);
            
            if (selesai >= mulai) {
                const hariKerja = hitungHariKerja(mulai, selesai);
                if (durasiEstimasi) {
                    durasiEstimasi.value = hariKerja + ' hari kerja';
                    durasiEstimasi.classList.remove('is-invalid');
                    durasiEstimasi.classList.add('is-valid');
                }
            } else {
                if (durasiEstimasi) {
                    durasiEstimasi.value = 'Tanggal tidak valid';
                    durasiEstimasi.classList.remove('is-valid');
                    durasiEstimasi.classList.add('is-invalid');
                }
            }
        } else {
            if (durasiEstimasi) {
                durasiEstimasi.value = '';
                durasiEstimasi.classList.remove('is-valid', 'is-invalid');
            }
        }
    }

    // Global variable untuk menyimpan daftar hari libur
    let daftarHariLibur = [];

    // Function untuk load daftar hari libur
    async function loadHariLibur() {
        try {
            const currentYear = new Date().getFullYear();
            // Load hari libur untuk tahun ini dan tahun depan
            const response = await fetch(`{{ path('api_hari_libur_by_year', {'year': '0'}) }}`.replace('0', currentYear));
            const responseNextYear = await fetch(`{{ path('api_hari_libur_by_year', {'year': '0'}) }}`.replace('0', currentYear + 1));
            
            if (response.ok && responseNextYear.ok) {
                const thisYear = await response.json();
                const nextYear = await responseNextYear.json();
                daftarHariLibur = [...thisYear, ...nextYear];
            }
        } catch (error) {
            console.warn('Gagal memuat daftar hari libur:', error);
            // Fallback: empty array, hanya exclude weekend
            daftarHariLibur = [];
        }
    }

    // Function untuk cek apakah tanggal adalah hari libur
    function isHariLibur(date) {
        const dateString = date.toISOString().split('T')[0]; // Format: YYYY-MM-DD
        return daftarHariLibur.includes(dateString);
    }

    // Function untuk menghitung hari kerja (exclude weekend dan hari libur)
    function hitungHariKerja(tanggalMulai, tanggalSelesai) {
        let hariKerja = 0;
        const current = new Date(tanggalMulai);
        const akhir = new Date(tanggalSelesai);
        
        while (current <= akhir) {
            // 0 = Sunday, 1 = Monday, ..., 6 = Saturday
            const dayOfWeek = current.getDay();
            // Hanya hitung jika bukan weekend (Senin = 1, Jumat = 5)
            if (dayOfWeek !== 0 && dayOfWeek !== 6) {
                // Check juga apakah hari libur
                if (!isHariLibur(current)) {
                    hariKerja++;
                }
            }
            current.setDate(current.getDate() + 1);
        }
        
        return hariKerja;
    }

    // Load hari libur saat halaman dimuat
    loadHariLibur();

    if (tanggalMulai) {
        tanggalMulai.addEventListener('change', hitungDurasi);
    }
    if (tanggalSelesai) {
        tanggalSelesai.addEventListener('change', hitungDurasi);
    }
    
    // Hitung durasi awal jika sudah ada nilai
    hitungDurasi();
});

// Function untuk konfirmasi submit
function confirmSubmit() {
    console.log('confirmSubmit() called');
    
    // Validasi form terlebih dahulu
    const form = document.querySelector('form');
    if (!form) {
        alert('Form tidak ditemukan. Refresh halaman dan coba lagi.');
        return;
    }
    
    // Gunakan HTML5 validation
    if (!form.checkValidity()) {
        form.reportValidity();
        return;
    }
    
    // Ambil data form dengan nama eksak dari Symfony
    const formData = new FormData(form);
    const jenisCutiSelect = form.querySelector('select[name*="jenisCuti"]');
    const tanggalMulaiInput = form.querySelector('input[name*="tanggalMulai"]');
    const tanggalSelesaiInput = form.querySelector('input[name*="tanggalSelesai"]');
    const alasanTextarea = form.querySelector('textarea[name*="alasan"]');
    const alamatCutiTextarea = form.querySelector('textarea[name*="alamatCuti"]');
    const teleponInput = form.querySelector('input[name*="userTelp"]');
    const durasiEstimasi = document.getElementById('durasi-estimasi');
    
    // Validasi minimum dengan fallback langsung submit jika ada masalah
    if (!jenisCutiSelect || !jenisCutiSelect.value) {
        alert('Jenis cuti harus dipilih');
        if (jenisCutiSelect) jenisCutiSelect.focus();
        return;
    }
    
    if (!tanggalMulaiInput || !tanggalMulaiInput.value) {
        alert('Tanggal mulai cuti harus diisi');
        if (tanggalMulaiInput) tanggalMulaiInput.focus();
        return;
    }
    
    if (!tanggalSelesaiInput || !tanggalSelesaiInput.value) {
        alert('Tanggal selesai cuti harus diisi');
        if (tanggalSelesaiInput) tanggalSelesaiInput.focus();
        return;
    }
    
    if (!alasanTextarea || !alasanTextarea.value.trim()) {
        alert('Alasan cuti harus diisi');
        if (alasanTextarea) alasanTextarea.focus();
        return;
    }
    
    if (!alamatCutiTextarea || !alamatCutiTextarea.value.trim()) {
        alert('Alamat selama menjalankan cuti harus diisi');
        if (alamatCutiTextarea) alamatCutiTextarea.focus();
        return;
    }
    
    // Isi data ke modal konfirmasi
    try {
        const jenisCutiText = jenisCutiSelect.options[jenisCutiSelect.selectedIndex].text;
        document.getElementById('confirm-jenis-cuti').textContent = jenisCutiText;
        document.getElementById('confirm-tanggal-mulai').textContent = formatDate(tanggalMulaiInput.value);
        document.getElementById('confirm-tanggal-selesai').textContent = formatDate(tanggalSelesaiInput.value);
        document.getElementById('confirm-durasi').textContent = (durasiEstimasi && durasiEstimasi.value) ? durasiEstimasi.value : '-';
        document.getElementById('confirm-alasan').textContent = alasanTextarea.value.substring(0, 100) + (alasanTextarea.value.length > 100 ? '...' : '');
        document.getElementById('confirm-alamat').textContent = alamatCutiTextarea.value.substring(0, 50) + (alamatCutiTextarea.value.length > 50 ? '...' : '');
        document.getElementById('confirm-telepon').textContent = (teleponInput && teleponInput.value) ? teleponInput.value : '-';
        
        // Tampilkan modal
        const modal = new bootstrap.Modal(document.getElementById('confirmModal'));
        modal.show();
    } catch (error) {
        console.error('Error filling modal:', error);
        // Fallback: submit langsung jika modal bermasalah
        if (confirm('Apakah Anda yakin ingin mengajukan cuti ini?')) {
            document.getElementById('btn-submit-hidden').click();
        }
    }
}

// Function untuk submit form setelah konfirmasi
function submitForm() {
    // Tutup modal
    const modal = bootstrap.Modal.getInstance(document.getElementById('confirmModal'));
    modal.hide();
    
    // Submit form dengan status submit
    document.getElementById('btn-submit-hidden').click();
}

// Function untuk konfirmasi pengajuan ulang cuti ditolak
function confirmResubmit() {
    console.log('confirmResubmit() called');
    
    // Validasi form terlebih dahulu
    const form = document.querySelector('form');
    if (!form) {
        alert('Form tidak ditemukan. Refresh halaman dan coba lagi.');
        return;
    }
    
    // Gunakan HTML5 validation
    if (!form.checkValidity()) {
        form.reportValidity();
        return;
    }
    
    // Ambil data form dengan nama eksak dari Symfony
    const jenisCutiSelect = form.querySelector('select[name*="jenisCuti"]');
    const tanggalMulaiInput = form.querySelector('input[name*="tanggalMulai"]');
    const tanggalSelesaiInput = form.querySelector('input[name*="tanggalSelesai"]');
    const alasanTextarea = form.querySelector('textarea[name*="alasan"]');
    const alamatCutiTextarea = form.querySelector('textarea[name*="alamatCuti"]');
    
    // Validasi minimum
    if (!jenisCutiSelect || !jenisCutiSelect.value) {
        alert('Jenis cuti harus dipilih');
        if (jenisCutiSelect) jenisCutiSelect.focus();
        return;
    }
    
    if (!tanggalMulaiInput || !tanggalMulaiInput.value) {
        alert('Tanggal mulai cuti harus diisi');
        if (tanggalMulaiInput) tanggalMulaiInput.focus();
        return;
    }
    
    if (!tanggalSelesaiInput || !tanggalSelesaiInput.value) {
        alert('Tanggal selesai cuti harus diisi');
        if (tanggalSelesaiInput) tanggalSelesaiInput.focus();
        return;
    }
    
    if (!alasanTextarea || !alasanTextarea.value.trim()) {
        alert('Alasan cuti harus diisi');
        if (alasanTextarea) alasanTextarea.focus();
        return;
    }
    
    if (!alamatCutiTextarea || !alamatCutiTextarea.value.trim()) {
        alert('Alamat selama menjalankan cuti harus diisi');
        if (alamatCutiTextarea) alamatCutiTextarea.focus();
        return;
    }
    
    // Konfirmasi pengajuan ulang dengan pesan khusus
    const confirmMessage = 'Apakah Anda yakin ingin mengajukan ulang cuti ini?\n\n' +
                          'Pastikan Anda sudah memperbaiki pengajuan berdasarkan alasan penolakan sebelumnya.\n\n' +
                          'Setelah diajukan ulang, pengajuan akan dikirim kepada atasan untuk ditinjau kembali.';
    
    if (confirm(confirmMessage)) {
        document.getElementById('btn-submit-hidden').click();
    }
}

// Function untuk format tanggal
function formatDate(dateString) {
    if (!dateString) return '-';
    
    const date = new Date(dateString);
    const options = { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    };
    
    return date.toLocaleDateString('id-ID', options);
}
</script>